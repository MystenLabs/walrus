"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[2464],{4870(e,i,n){n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});let s=JSON.parse('{"id":"operator-guide/signed-binaries","title":"Verifying Signed Binaries","description":"How to download and verify signed Walrus binaries and Docker images using Cosign.","source":"@site/../content/operator-guide/signed-binaries.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/signed-binaries","permalink":"/walrus/pr-preview/pr-2939/docs/operator-guide/signed-binaries","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/signed-binaries.mdx","tags":[],"version":"current","frontMatter":{"title":"Verifying Signed Binaries","description":"How to download and verify signed Walrus binaries and Docker images using Cosign.","keywords":["walrus","signed binaries","verification","cosign","docker images","security","release"]},"sidebar":"operatorSidebar","previous":{"title":"The Walrus Upload Relay","permalink":"/walrus/pr-preview/pr-2939/docs/operator-guide/upload-relay"}}');var r=n(2615),a=n(5756);let l={title:"Verifying Signed Binaries",description:"How to download and verify signed Walrus binaries and Docker images using Cosign.",keywords:["walrus","signed binaries","verification","cosign","docker images","security","release"]},d,t={},o=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Using the verification script",id:"using-the-verification-script",level:2},{value:"List available binaries",id:"list-available-binaries",level:3},{value:"Download and verify a binary",id:"download-and-verify-a-binary",level:3},{value:"Available platforms",id:"available-platforms",level:3},{value:"Available binaries",id:"available-binaries",level:3},{value:"Verify a Docker image",id:"verify-a-docker-image",level:3},{value:"Using GCP KMS key directly",id:"using-gcp-kms-key-directly",level:3},{value:"Manual verification",id:"manual-verification",level:2},{value:"Download binaries",id:"download-binaries",level:3},{value:"Verify using the public key",id:"verify-using-the-public-key",level:3},{value:"Verify using GCP KMS key directly",id:"verify-using-gcp-kms-key-directly",level:3},{value:"Docker images",id:"docker-images",level:2},{value:"Verify a Docker image manually",id:"verify-a-docker-image-manually",level:3},{value:"Verify the image digest matches",id:"verify-the-image-digest-matches",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Permission denied when verifying",id:"permission-denied-when-verifying",level:3},{value:"Signature verification failed",id:"signature-verification-failed",level:3},{value:"&quot;no matching signatures&quot; error for Docker images",id:"no-matching-signatures-error-for-docker-images",level:3},{value:"Image not found",id:"image-not-found",level:3},{value:"Security",id:"security",level:2}];function c(e){let i={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components},{Term:n}=i;return n||function(e,i){throw Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"This document explains how to download and verify signed Walrus binaries and Docker images."}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(i.p,{children:["Walrus release binaries and Docker images are signed using\n",(0,r.jsx)(i.a,{href:"https://github.com/sigstore/cosign",children:"Cosign"})," with a GCP KMS key. Each binary has a\ncorresponding ",(0,r.jsx)(i.code,{children:".sig"})," file containing its signature, and Docker image signatures are stored\nin the registry."]}),"\n",(0,r.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Install ",(0,r.jsx)(i.a,{href:"https://docs.sigstore.dev/cosign/system_config/installation/",children:"Cosign"})]}),"\n",(0,r.jsxs)(i.li,{children:["Install the ",(0,r.jsx)(i.a,{href:"https://cloud.google.com/sdk/docs/install",children:"gcloud CLI"})," (for downloading binaries)"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"using-the-verification-script",children:"Using the verification script"}),"\n",(0,r.jsx)(i.p,{children:"The easiest way to download and verify binaries is using the provided script:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the script\ncurl -sSfL https://raw.githubusercontent.com/MystenLabs/walrus/main/scripts/verify-release.sh -o verify-release.sh\nchmod +x verify-release.sh\n"})}),"\n",(0,r.jsx)(i.h3,{id:"list-available-binaries",children:"List available binaries"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"./verify-release.sh list -r <ref>\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Where ",(0,r.jsx)(i.code,{children:"<ref>"})," is a git reference (branch, tag, or commit SHA)."]}),"\n",(0,r.jsx)(i.h3,{id:"download-and-verify-a-binary",children:"Download and verify a binary"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download a binary\n./verify-release.sh download -r v1.0.0 -b walrus -p ubuntu-x86_64 -o ./walrus\n\n# Verify the downloaded binary\n./verify-release.sh verify -b ./walrus\n"})}),"\n",(0,r.jsx)(i.h3,{id:"available-platforms",children:"Available platforms"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Platform"}),(0,r.jsx)(i.th,{children:"Option value"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Linux x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"ubuntu-x86_64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Linux ARM64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"ubuntu-aarch64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"macOS x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"macos-x86_64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"macOS ARM64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"macos-arm64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Windows x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"windows-x86_64.exe"})})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"available-binaries",children:"Available binaries"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Binary"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus"})}),(0,r.jsxs)(i.td,{children:["The Walrus CLI ",(0,r.jsx)(n,{lookup:"Client",children:"client"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus-node"})}),(0,r.jsxs)(i.td,{children:["The Walrus ",(0,r.jsx)(n,{lookup:"Storage node",children:"storage node"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus-upload-relay"})}),(0,r.jsx)(i.td,{children:"The Walrus upload relay service"})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"verify-a-docker-image",children:"Verify a Docker image"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Verify a signed Docker image\n./verify-release.sh docker -i mysten/walrus-service:abc123-signed\n"})}),"\n",(0,r.jsx)(i.h3,{id:"using-gcp-kms-key-directly",children:"Using GCP KMS key directly"}),"\n",(0,r.jsx)(i.p,{children:"If you have GCP access, you can verify using the KMS key directly:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Authenticate with GCP first\ngcloud auth application-default login\n\n# Verify using KMS key\n./verify-release.sh verify -b ./walrus --use-kms\n./verify-release.sh docker -i mysten/walrus-service:abc123-signed --use-kms\n"})}),"\n",(0,r.jsx)(i.h2,{id:"manual-verification",children:"Manual verification"}),"\n",(0,r.jsx)(i.p,{children:"If you prefer to verify manually without the script:"}),"\n",(0,r.jsx)(i.h3,{id:"download-binaries",children:"Download binaries"}),"\n",(0,r.jsx)(i.p,{children:"Signed binaries are stored in Google Cloud Storage:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the binary\ngcloud storage cp gs://mysten-walrus-binaries/signed/<ref>/walrus-ubuntu-x86_64 ./walrus\n\n# Download the signature\ngcloud storage cp gs://mysten-walrus-binaries/signed/<ref>/walrus-ubuntu-x86_64.sig ./walrus.sig\n"})}),"\n",(0,r.jsx)(i.h3,{id:"verify-using-the-public-key",children:"Verify using the public key"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the public key\ncurl -sSfL https://docs.walrus.site/walrus-signing.pub -o walrus-signing.pub\n\n# Verify the binary\ncosign verify-blob \\\n  --key walrus-signing.pub \\\n  --signature walrus.sig \\\n  --insecure-ignore-tlog \\\n  walrus\n"})}),"\n",(0,r.jsx)(i.p,{children:"On success, you'll see:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Verified OK\n"})}),"\n",(0,r.jsx)(i.admonition,{type:"note",children:(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"--insecure-ignore-tlog"})," flag is required because signatures are not uploaded\nto the Sigstore transparency log. Verification is still cryptographically secure using\nthe signing key."]})}),"\n",(0,r.jsx)(i.h3,{id:"verify-using-gcp-kms-key-directly",children:"Verify using GCP KMS key directly"}),"\n",(0,r.jsx)(i.p,{children:"If you have GCP access:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Authenticate with GCP\ngcloud auth application-default login\n\n# Verify the binary\ncosign verify-blob \\\n  --key gcpkms://projects/walrus-infra/locations/global/keyRings/walrus-signing/cryptoKeys/release-sign \\\n  --signature walrus.sig \\\n  --insecure-ignore-tlog \\\n  walrus\n"})}),"\n",(0,r.jsx)(i.h2,{id:"docker-images",children:"Docker images"}),"\n",(0,r.jsxs)(i.p,{children:["Signed Docker images are available with the ",(0,r.jsx)(i.code,{children:"-signed"})," suffix:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mysten/walrus-service:<sha>-signed"})," - Walrus ","storage node"," service"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"mysten/walrus-upload-relay:<sha>-signed"})," - Walrus upload relay service"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["Where ",(0,r.jsx)(i.code,{children:"<sha>"})," is the git commit SHA used to build the image."]}),"\n",(0,r.jsx)(i.h3,{id:"verify-a-docker-image-manually",children:"Verify a Docker image manually"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Using the public key\ncurl -sSfL https://docs.walrus.site/walrus-signing.pub -o walrus-signing.pub\ncosign verify --key walrus-signing.pub mysten/walrus-service:abc123-signed\n\n# Or using GCP KMS key directly\ncosign verify \\\n  --key gcpkms://projects/walrus-infra/locations/global/keyRings/walrus-signing/cryptoKeys/release-sign \\\n  mysten/walrus-service:abc123-signed\n"})}),"\n",(0,r.jsx)(i.h3,{id:"verify-the-image-digest-matches",children:"Verify the image digest matches"}),"\n",(0,r.jsx)(i.p,{children:"To ensure the image you pulled matches what was signed:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Get the digest of your local image\ndocker inspect --format='{{index .RepoDigests 0}}' mysten/walrus-service:abc123-signed\n\n# Compare with the digest shown in the cosign verify output\n"})}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(i.h3,{id:"permission-denied-when-verifying",children:"Permission denied when verifying"}),"\n",(0,r.jsx)(i.p,{children:"If you get a permission denied error when using the GCP KMS key directly:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Authenticate with GCP: ",(0,r.jsx)(i.code,{children:"gcloud auth application-default login"})]}),"\n",(0,r.jsx)(i.li,{children:"Or use the public key method instead"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"signature-verification-failed",children:"Signature verification failed"}),"\n",(0,r.jsx)(i.p,{children:"If verification fails:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Ensure you downloaded both the binary and signature for the same version"}),"\n",(0,r.jsx)(i.li,{children:"Ensure the files weren't corrupted during download"}),"\n",(0,r.jsx)(i.li,{children:"Try re-downloading both files"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"no-matching-signatures-error-for-docker-images",children:'"no matching signatures" error for Docker images'}),"\n",(0,r.jsxs)(i.p,{children:["If you see ",(0,r.jsx)(i.code,{children:"Error: no matching signatures"}),":"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Ensure the image tag includes the ",(0,r.jsx)(i.code,{children:"-signed"})," suffix"]}),"\n",(0,r.jsx)(i.li,{children:"Verify the commit SHA is correct"}),"\n",(0,r.jsx)(i.li,{children:"Check that the image was actually signed"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"image-not-found",children:"Image not found"}),"\n",(0,r.jsx)(i.p,{children:"If the Docker image is not found:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Verify the commit SHA exists in the repository"}),"\n",(0,r.jsx)(i.li,{children:"Check that the signed binaries workflow ran successfully for that commit"}),"\n",(0,r.jsx)(i.li,{children:"Ensure you're using the correct image name"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"security",children:"Security"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The signing key is stored in GCP KMS and cannot be exported"}),"\n",(0,r.jsx)(i.li,{children:"Only authorized CI/CD workflows can sign binaries and images"}),"\n",(0,r.jsx)(i.li,{children:"Each binary is signed individually, not just the archive"}),"\n",(0,r.jsx)(i.li,{children:"Docker image signatures are stored in the registry alongside the image"}),"\n"]})]})}function h(e={}){let{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},5756(e,i,n){n.d(i,{R:()=>l,x:()=>d});var s=n(9471);let r={},a=s.createContext(r);function l(e){let i=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(a.Provider,{value:i},e.children)}}}]);